---
kind: pipeline
name: default

clone:
  disable: true

services:
  - name: mysql
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: go-admin-test

  - name: pgsql
    image: postgres:10
    environment:
      POSTGRES_USER: postgres
      POSTGRES_DB: go-admin-test

  - name: mssql
    image: mcr.microsoft.com/mssql/server:latest
    environment:
      ACCEPT_EULA: Y
      SA_PASSWORD: Aa123456

steps:
  - name: clone
    image: alpine/git
    commands:
      - echo "199.232.69.194 github.global-ssl.fastly.net" >> /etc/hosts
      - echo "140.82.113.4 github.com" >> /etc/hosts
      - git clone https://github.com/GoAdminGroup/go-admin.git .
      - git checkout $DRONE_COMMIT  
  - name: backend
    image: goadmin-test:v1
    environment:
      GO111MODULE: on
      GOPROXY: off
    commands:
      - go version
      - echo "hello world"
      - mysql -h mysql -u root -proot -e 'create database \`go-admin-test\`;'